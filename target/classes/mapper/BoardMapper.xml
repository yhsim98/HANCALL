<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="repository.BoardMapper">

    <insert parameterType="domain.Board" id="insertBoard">
        INSERT INTO board(writer_id, starting_point, destination, title, content, created_date, update_date, max_participants)
            VALUES(#{writer_Id}, #{starting_Point}, #{destination}, #{title}, #{content}, DEFAULT, DEFAULT, #{max_Participants})
        <selectKey keyProperty="board_Id" resultType="Long">
            SELECT LAST_INSERT_ID()
        </selectKey>
    </insert>

    <select id="getBoardList" resultType="domain.Board">
        SELECT board_id, starting_point, destination, title, update_date, user.nickname, max_participants
        FROM board
        LEFT JOIN user ON board.writer_id=user.id
    </select>

    <select id="getBoardById" resultType="domain.Board" parameterType="Long">
        SELECT board_id, writer_id, starting_point, destination, created_date,
               update_date, title, content, user.nickname, max_participants
        FROM board
        LEFT JOIN user ON board.writer_id=user.id
        WHERE board_id=#{boardId}
    </select>

    <select id="searchBoard" parameterType="domain.Board" resultType="domain.Board">
        SELECT board_id, starting_point, destination, created_date, update_date, title,
               content, user.nickname, max_participants
        FROM board
        LEFT JOIN user ON board.writer_id=user.id
        <where>
            <if test="destination != ''">
                destination=#{destination}
            </if>
            <if test="starting_Point != ''">
                AND starting_point=#{starting_Point}
            </if>
        </where>
    </select>

    <select id="getMaxParticipants" parameterType="Long" resultType="Integer">
        SELECT max_participants FROM board WHERE board_id=#{boardId}
    </select>

    <update id="updateBoard" parameterType="domain.Board" >
        UPDATE board
        SET
            starting_point=#{starting_Point},
            destination=#{destination},
            title=#{title},
            content=#{content},
            max_participants=#{max_Participants},
            update_date=DEFAULT
        WHERE board_id=#{board_Id}
    </update>

    <delete id="deleteBoard" parameterType="Long">
        DELETE FROM board where board_id=#{boardId}
    </delete>
</mapper>